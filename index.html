<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Neon Snake Game</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link rel="manifest" href="manifest.json" />
    <style>
      :root {
        --primary-neon: #00ff9d;
        --secondary-neon: #ff2d75;
        --accent-neon: #8a2be2;
        --bg-dark: #0f0f1a;
        --board-bg: #1a1a2e;
        --text-glow: 0 0 10px currentColor;
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Orbitron", sans-serif;
        background: radial-gradient(circle at center, #1a1a2e, var(--bg-dark));
        color: #e0e0ff;
        min-height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
      }

      .game-container {
        width: 100vw;
        height: 100dvh;
        min-height: 100dvh;
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: flex-start;
        padding: 0;
        gap: 0.5rem;
        position: relative;
        overflow: hidden;
      }

      .header {
        text-align: center;
        animation: fadeIn 1s ease-out;
        width: 100%;
        max-width: 800px;
      }

      .title {
        font-size: clamp(2rem, 6vw, 4.5rem);
        font-weight: 700;
        color: var(--primary-neon);
        text-shadow: var(--text-glow), 0 0 20px var(--primary-neon),
          0 0 40px rgba(0, 255, 157, 0.3);
        margin-bottom: clamp(0.5rem, 2vw, 1rem);
        letter-spacing: 0.2em;
        animation: glow 1.5s ease-in-out infinite alternate;
      }

      @keyframes glow {
        from {
          text-shadow: var(--text-glow), 0 0 20px var(--primary-neon),
            0 0 40px rgba(0, 255, 157, 0.3);
        }
        to {
          text-shadow: var(--text-glow), 0 0 25px var(--primary-neon),
            0 0 50px rgba(0, 255, 157, 0.5);
        }
      }

      .stats-container {
        display: flex;
        gap: clamp(0.5rem, 2vw, 1rem);
        flex-wrap: wrap;
        justify-content: center;
        margin-bottom: clamp(0.5rem, 2vw, 1rem);
        width: 100%;
        max-width: 800px;
      }

      .stat-box {
        background: rgba(138, 43, 226, 0.15);
        border: 2px solid var(--accent-neon);
        border-radius: 12px;
        padding: clamp(0.6rem, 2vw, 1rem) clamp(1rem, 3vw, 1.5rem);
        min-width: clamp(100px, 25vw, 150px);
        backdrop-filter: blur(5px);
        transition: all 0.3s ease;
        flex: 1;
        max-width: 200px;
      }

      .stat-box:hover {
        transform: translateY(-2px) scale(1.02);
        background: rgba(138, 43, 226, 0.25);
        box-shadow: 0 0 20px rgba(138, 43, 226, 0.4);
      }

      .stat-label {
        font-size: 0.9rem;
        color: #a8a8ff;
        margin-bottom: 0.3rem;
      }

      .stat-value {
        font-size: 1.5rem;
        font-weight: 600;
        color: var(--secondary-neon);
        text-shadow: var(--text-glow);
      }

      .canvas-container {
        position: relative;
        flex: 1 1 auto;
        display: flex;
        align-items: center;
        justify-content: center;
        width: min(90vw, 70vh);
        height: auto;
        max-width: 100vw;
        max-height: calc(100dvh - 320px);
        aspect-ratio: 1 / 1;
        background: var(--board-bg);
        border: 3px solid var(--accent-neon);
        border-radius: clamp(12px, 3vw, 20px);
        overflow: hidden;
        box-shadow: 0 0 30px rgba(138, 43, 226, 0.3),
          inset 0 0 20px rgba(138, 43, 226, 0.2);
        transition: transform 0.3s ease;
        margin-bottom: 0;
      }

      .canvas-container::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          45deg,
          transparent 0%,
          rgba(138, 43, 226, 0.1) 45%,
          rgba(138, 43, 226, 0.2) 50%,
          rgba(138, 43, 226, 0.1) 55%,
          transparent 100%
        );
        pointer-events: none;
        opacity: 0.5;
      }

      #game-board {
        width: 100%;
        height: 100%;
        display: block;
      }

      .controls {
        display: none;
        grid-template-columns: repeat(3, 1fr);
        gap: clamp(0.5rem, 2vw, 0.8rem);
        width: min(100%, 300px);
        margin-top: clamp(1rem, 3vw, 1.5rem);
      }

      .control-btn {
        background: rgba(138, 43, 226, 0.15);
        border: 2px solid var(--accent-neon);
        border-radius: clamp(8px, 2vw, 12px);
        padding: clamp(0.8rem, 3vw, 1.2rem);
        color: var(--primary-neon);
        font-size: clamp(1.2rem, 4vw, 1.5rem);
        text-shadow: var(--text-glow);
        cursor: pointer;
        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
        user-select: none;
        -webkit-tap-highlight-color: transparent;
        position: relative;
        overflow: hidden;
      }

      .control-btn::before {
        content: "";
        position: absolute;
        inset: 0;
        background: radial-gradient(
          circle at center,
          rgba(138, 43, 226, 0.3),
          transparent 70%
        );
        opacity: 0;
        transition: opacity 0.3s ease;
      }

      .control-btn:active::before {
        opacity: 1;
      }

      .control-btn:active {
        transform: scale(0.95);
        background: rgba(138, 43, 226, 0.3);
      }

      .modal {
        position: fixed;
        inset: 0;
        background: rgba(15, 15, 26, 0.98);
        backdrop-filter: blur(10px);
        display: flex;
        align-items: center;
        justify-content: center;
        padding: clamp(1rem, 3vw, 2rem);
        z-index: 1000;
        opacity: 0;
        pointer-events: none;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .modal.active {
        opacity: 1;
        pointer-events: auto;
      }

      .modal-content {
        background: rgba(26, 26, 46, 0.95);
        border: 2px solid var(--accent-neon);
        border-radius: clamp(16px, 4vw, 24px);
        padding: clamp(1.5rem, 4vw, 2.5rem);
        max-width: min(500px, 90vw);
        width: 100%;
        text-align: center;
        box-shadow: 0 0 30px rgba(138, 43, 226, 0.3),
          inset 0 0 20px rgba(138, 43, 226, 0.1);
        transform: scale(0.9);
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .modal.active .modal-content {
        transform: scale(1);
      }

      .modal-title {
        font-size: 2rem;
        color: var(--primary-neon);
        text-shadow: var(--text-glow);
        margin-bottom: 1.5rem;
      }

      .btn {
        background: linear-gradient(45deg, var(--accent-neon) 0%, #b44dff 100%);
        color: white;
        border: none;
        border-radius: clamp(8px, 2vw, 12px);
        padding: clamp(0.8rem, 2.5vw, 1.2rem) clamp(1.5rem, 4vw, 2.5rem);
        font-family: "Orbitron", sans-serif;
        font-size: clamp(1rem, 2.5vw, 1.2rem);
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        text-shadow: var(--text-glow);
        margin-top: clamp(1rem, 3vw, 1.5rem);
        position: relative;
        overflow: hidden;
      }

      .btn::before {
        content: "";
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(
          90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 100%
        );
        transition: left 0.5s ease;
      }

      .btn:hover::before {
        left: 100%;
      }

      .btn:hover {
        transform: translateY(-2px);
        box-shadow: 0 0 20px var(--accent-neon);
      }

      .btn:active {
        transform: translateY(0);
      }

      .powerup-indicator {
        position: absolute;
        top: 1rem;
        right: 1rem;
        padding: clamp(0.5rem, 2vw, 0.8rem) clamp(0.8rem, 3vw, 1.2rem);
        border-radius: clamp(6px, 2vw, 8px);
        background: rgba(255, 255, 255, 0.1);
        border: 1px solid var(--accent-neon);
        font-size: clamp(0.8rem, 2vw, 1rem);
        font-weight: 500;
        opacity: 0;
        transform: translateY(-10px);
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      }

      .powerup-indicator.active {
        opacity: 1;
        transform: translateY(0);
      }

      @media (max-width: 768px) {
        .controls {
          display: grid;
        }

        .stat-box {
          min-width: clamp(90px, 25vw, 120px);
          padding: clamp(0.5rem, 2vw, 0.8rem) clamp(0.8rem, 3vw, 1rem);
        }

        .stat-value {
          font-size: clamp(1rem, 3vw, 1.2rem);
        }

        .canvas-container {
          max-width: 98vw;
          max-height: calc(100dvh - 340px);
        }
      }

      @media (max-width: 500px) {
        .canvas-container {
          max-width: 99vw;
          max-height: calc(100dvh - 370px);
        }
      }

      @media (max-height: 700px) {
        .game-container {
          padding: 0.5rem;
          gap: 0.8rem;
        }

        .title {
          font-size: clamp(1.5rem, 4vw, 2.5rem);
          margin-bottom: 0.5rem;
        }

        .canvas-container {
          max-width: 90vw;
          max-height: calc(100dvh - 250px);
        }
      }

      @media (orientation: landscape) and (max-height: 600px) {
        .game-container {
          flex-direction: row;
          flex-wrap: wrap;
          justify-content: center;
          height: auto;
          min-height: 100dvh;
        }

        .header {
          order: 1;
          width: 30%;
          min-width: 200px;
        }

        .canvas-container {
          order: 2;
          max-width: 70vh;
          max-height: 70vh;
        }

        .controls {
          order: 3;
          width: 30%;
          min-width: 200px;
        }
      }

      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(-20px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      @keyframes pulse {
        0% {
          transform: scale(1);
          opacity: 1;
        }
        50% {
          transform: scale(1.05);
          opacity: 0.8;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes neonPop {
        0% {
          transform: scale(0.7);
          opacity: 0;
        }
        60% {
          transform: scale(1.08);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }
      .neon-modal-content {
        border: 2.5px solid #00ff9d;
        background: linear-gradient(
          120deg,
          rgba(26, 26, 46, 0.98) 80%,
          rgba(138, 43, 226, 0.08) 100%
        );
        box-shadow: 0 0 40px #00ff9d, 0 0 80px #8a2be2;
      }
      #name-modal input#player-name-input::placeholder {
        color: #a8ffe3;
        opacity: 0.7;
        letter-spacing: 0.05em;
      }
      #name-modal input#player-name-input:focus {
        border-color: #8a2be2;
      }
      .neon-name-form {
        margin: 1.5rem 0 0 0;
        display: flex;
        gap: 0.7rem;
        align-items: center;
        justify-content: center;
      }
      .neon-name-input,
      .neon-name-btn {
        height: 54px;
        border-radius: 12px;
        box-sizing: border-box;
        font-size: 1.2rem;
        margin: 0;
        line-height: 1;
        display: flex;
        align-items: center;
      }
      .neon-name-input {
        flex: 1;
        padding: 0 1.2rem;
        border: 2px solid #00ff9d;
        background: rgba(26, 26, 46, 0.95);
        color: #fff;
        box-shadow: 0 0 12px #00ff9d, 0 0 24px #8a2be2;
        outline: none;
        transition: box-shadow 0.3s;
        min-width: 0;
      }
      .neon-name-input:focus {
        box-shadow: 0 0 20px #00ff9d, 0 0 40px #8a2be2;
        border-color: #8a2be2;
      }
      .neon-name-btn {
        padding: 0 2.2rem;
        background: linear-gradient(45deg, #00ff9d 0%, #8a2be2 100%);
        box-shadow: 0 0 10px #00ff9d, 0 0 20px #8a2be2;
        min-width: 0;
        font-size: 1.1rem;
        font-family: inherit;
        font-weight: 600;
        color: #fff;
        border: none;
        cursor: pointer;
      }
      .neon-leaderboard-box {
        margin: 1.5rem auto 2.5rem auto;
        padding: 1.2rem 2.2rem;
        background: rgba(26, 26, 46, 0.95);
        border: 2.5px solid #00ff9d;
        border-radius: 18px;
        box-shadow: 0 0 24px #00ff9d, 0 0 40px #8a2be2;
        max-width: 350px;
        min-width: 220px;
        text-align: left;
      }
      #leaderboard-list ol {
        list-style: decimal inside;
        padding-left: 0;
        margin: 0;
      }
      #leaderboard-list li {
        font-family: "Orbitron", sans-serif;
        font-size: 1.25rem;
        color: #00ff9d;
        text-shadow: 0 0 8px #00ff9d, 0 0 16px #8a2be2;
        margin-bottom: 0.5rem;
        letter-spacing: 0.04em;
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }
      #leaderboard-list li strong {
        color: #fff;
        text-shadow: 0 0 8px #00ff9d, 0 0 16px #8a2be2;
        font-weight: 700;
      }
      .neon-leaderboard-btn {
        margin-top: 1.5rem;
        padding: 1.1rem 3.2rem;
        font-size: 1.3rem;
        background: linear-gradient(45deg, #b44dff 0%, #8a2be2 100%);
        border-radius: 14px;
        box-shadow: 0 0 16px #8a2be2, 0 0 32px #b44dff;
      }
      .neon-install-btn {
        background: linear-gradient(45deg, #00ff9d 0%, #8a2be2 100%);
        color: #fff;
        border-radius: 12px;
        box-shadow: 0 0 10px #00ff9d, 0 0 20px #8a2be2;
        font-size: 1.1rem;
        font-family: "Orbitron", sans-serif;
        font-weight: 600;
        padding: 0.9rem 2.2rem;
        margin: 0 0.5rem;
        display: none;
      }
      .neon-share-btn {
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 1.15rem;
        font-family: "Orbitron", sans-serif;
        font-weight: 600;
        color: #fff;
        background: linear-gradient(45deg, #232946 0%, #8a2be2 100%);
        border: 2px solid #8a2be2;
        border-radius: 12px;
        box-shadow: 0 0 10px #8a2be2, 0 0 20px #b44dff;
        padding: 0.7rem 1.2rem;
        text-decoration: none;
        transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
        margin: 0;
        width: 100%;
        max-width: 260px;
      }
      .neon-share-btn:hover,
      .neon-share-btn:focus {
        background: linear-gradient(45deg, #8a2be2 0%, #232946 100%);
        box-shadow: 0 0 20px #8a2be2, 0 0 40px #b44dff;
        transform: scale(1.04);
      }
      @media (max-width: 500px) {
        .modal-content.neon-modal-content {
          max-width: 98vw;
          padding: 1.2rem 0.5rem;
        }
        .neon-share-btn {
          font-size: 1rem;
          padding: 0.7rem 0.5rem;
          max-width: 98vw;
        }
      }
      .neon-action-btn {
        background: linear-gradient(45deg, #00ff9d 0%, #8a2be2 100%);
        color: #fff;
        border-radius: 12px;
        box-shadow: 0 0 10px #00ff9d, 0 0 20px #8a2be2;
        font-size: 1.1rem;
        font-family: "Orbitron", sans-serif;
        font-weight: 600;
        padding: 0.9rem 2.2rem;
        margin: 0 0.5rem;
        min-width: 120px;
        transition: background 0.2s, box-shadow 0.2s, transform 0.1s;
      }
      .neon-action-btn:hover,
      .neon-action-btn:focus {
        background: linear-gradient(45deg, #8a2be2 0%, #00ff9d 100%);
        box-shadow: 0 0 20px #8a2be2, 0 0 40px #00ff9d;
        transform: scale(1.04);
      }
      @media (max-width: 600px) {
        .game-action-buttons {
          flex-direction: column;
          gap: 0.3rem;
          margin-bottom: 0.1rem;
        }
        .neon-action-btn {
          width: 100%;
          min-width: 0;
          padding: 1rem 0;
        }
      }
    </style>
  </head>
  <body>
    <div class="game-container">
      <header class="header">
        <h1 class="title">NEON SNAKE</h1>
        <div class="stats-container">
          <div class="stat-box">
            <div class="stat-label">SCORE</div>
            <div class="stat-value" id="score">0</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">HIGH SCORE</div>
            <div class="stat-value" id="high-score">0</div>
          </div>
          <div class="stat-box">
            <div class="stat-label">LEVEL</div>
            <div class="stat-value" id="level">1</div>
          </div>
        </div>
      </header>

      <div
        style="
          display: flex;
          gap: 1rem;
          justify-content: center;
          margin-bottom: 1rem;
          flex-wrap: wrap;
        "
      >
        <button
          class="btn neon-install-btn"
          id="install-btn"
          style="display: none"
        >
          INSTALL
        </button>
        <button
          class="btn"
          id="share-btn"
          style="background: linear-gradient(45deg, #ff2d75 0%, #8a2be2 100%)"
        >
          SHARE
        </button>
        <button class="btn" id="leaderboard-btn">LEADERBOARD</button>
        <button class="btn" id="group-btn">GROUP</button>
      </div>

      <div class="canvas-container">
        <canvas id="game-board"></canvas>
        <div class="powerup-indicator" id="powerup-indicator"></div>
      </div>

      <div class="controls">
        <div></div>
        <button class="control-btn" id="up-btn">↑</button>
        <div></div>
        <button class="control-btn" id="left-btn">←</button>
        <button class="control-btn" id="down-btn">↓</button>
        <button class="control-btn" id="right-btn">→</button>
      </div>

      <div
        class="game-action-buttons"
        id="game-action-buttons"
        style="
          flex-direction: row;
          gap: 1.2rem;
          margin-top: 0.5rem;
          margin-bottom: 0;
          justify-content: center;
          width: 100%;
        "
      >
        <button class="btn neon-action-btn" id="main-start-btn">START</button>
        <button class="btn neon-action-btn" id="pause-resume-btn">PAUSE</button>
      </div>

      <!-- Game Over Modal -->
      <div class="modal" id="game-over-modal">
        <div class="modal-content">
          <h2 class="modal-title">GAME OVER</h2>
          <div class="stats-container">
            <div class="stat-box">
              <div class="stat-label">FINAL SCORE</div>
              <div class="stat-value" id="final-score">0</div>
            </div>
            <div class="stat-box">
              <div class="stat-label">HIGH SCORE</div>
              <div class="stat-value" id="final-high-score">0</div>
            </div>
          </div>
          <div style="display: flex; gap: 1.2rem; justify-content: center">
            <button class="btn" id="restart-btn">PLAY AGAIN</button>
            <button class="btn" id="back-btn">BACK</button>
          </div>
        </div>
      </div>

      <!-- Instructions Modal -->
      <div class="modal active" id="instructions-modal">
        <div class="modal-content">
          <h2 class="modal-title">HOW TO PLAY</h2>
          <div style="text-align: left; margin-bottom: 1.5rem">
            <h3 style="color: var(--secondary-neon); margin-bottom: 0.5rem">
              Controls:
            </h3>
            <p>↑ / W - Move Up</p>
            <p>↓ / S - Move Down</p>
            <p>← / A - Move Left</p>
            <p>→ / D - Move Right</p>
            <p>SPACE - Pause/Resume</p>
            <p style="color: #888; font-size: 0.9rem; margin-top: 0.5rem">
              Touch controls available on mobile
            </p>

            <h3 style="color: var(--secondary-neon); margin: 1rem 0 0.5rem">
              Rules:
            </h3>
            <p>• Eat food to grow and score points</p>
            <p>• Avoid hitting walls and yourself</p>
            <p>• Level up every 50 points</p>
            <p>• Collect powerups for special effects</p>
          </div>
          <button class="btn" id="start-btn">PROCEED</button>
        </div>
      </div>

      <!-- Pause Modal -->
      <div class="modal" id="pause-modal">
        <div class="modal-content">
          <h2 class="modal-title">PAUSED</h2>
          <button class="btn" id="resume-btn">RESUME</button>
        </div>
      </div>

      <!-- Leaderboard Modal -->
      <div class="modal" id="leaderboard-modal">
        <div class="modal-content">
          <h2 class="modal-title">LEADERBOARD</h2>
          <div class="neon-leaderboard-box">
            <div id="leaderboard-list"></div>
          </div>
          <button class="btn neon-leaderboard-btn" id="close-leaderboard-btn">
            CLOSE
          </button>
        </div>
      </div>

      <!-- Group Modal -->
      <div class="modal" id="group-modal">
        <div class="modal-content">
          <h2 class="modal-title">GROUP & TEAMMATES</h2>
          <form
            id="add-teammate-form"
            class="neon-name-form"
            style="margin-bottom: 1rem"
          >
            <input
              type="text"
              id="teammate-name"
              class="neon-name-input"
              placeholder="Teammate Name"
              required
            />
            <button
              type="submit"
              class="btn neon-name-btn"
              style="
                background: linear-gradient(45deg, #b44dff 0%, #8a2be2 100%);
              "
            >
              ADD
            </button>
          </form>
          <div
            id="group-list"
            style="margin-bottom: 1.5rem; text-align: left"
          ></div>
          <button class="btn" id="close-group-btn">CLOSE</button>
        </div>
      </div>

      <!-- Name Entry Modal -->
      <div class="modal active" id="name-modal">
        <div
          class="modal-content neon-modal-content"
          style="
            box-shadow: 0 0 40px #00ff9d, 0 0 80px #8a2be2;
            animation: neonPop 0.7s cubic-bezier(0.4, 0, 0.2, 1);
          "
        >
          <div
            style="
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
            "
          >
            <div style="margin-bottom: 1rem">
              <svg
                width="60"
                height="60"
                viewBox="0 0 60 60"
                fill="none"
                xmlns="http://www.w3.org/2000/svg"
              >
                <circle
                  cx="30"
                  cy="30"
                  r="28"
                  stroke="#00ff9d"
                  stroke-width="4"
                  fill="#1a1a2e"
                  filter="url(#glow)"
                />
                <ellipse
                  cx="30"
                  cy="26"
                  rx="12"
                  ry="10"
                  fill="#00ff9d"
                  fill-opacity="0.15"
                />
                <ellipse
                  cx="30"
                  cy="26"
                  rx="7"
                  ry="6"
                  fill="#00ff9d"
                  fill-opacity="0.25"
                />
                <ellipse
                  cx="30"
                  cy="44"
                  rx="14"
                  ry="8"
                  fill="#8a2be2"
                  fill-opacity="0.12"
                />
                <defs>
                  <filter id="glow" x="-10" y="-10" width="80" height="80">
                    <feGaussianBlur stdDeviation="4" result="coloredBlur" />
                    <feMerge>
                      <feMergeNode in="coloredBlur" />
                      <feMergeNode in="SourceGraphic" />
                    </feMerge>
                  </filter>
                </defs>
              </svg>
            </div>
            <h2
              class="modal-title"
              style="
                color: var(--primary-neon);
                text-shadow: 0 0 10px #00ff9d, 0 0 20px #8a2be2;
                letter-spacing: 0.1em;
              "
            >
              ENTER YOUR NAME
            </h2>
          </div>
          <form id="name-form" class="neon-name-form">
            <input
              type="text"
              id="player-name-input"
              class="neon-name-input"
              placeholder="Your Name"
              maxlength="16"
              autocomplete="off"
              required
            />
            <button type="submit" class="btn neon-name-btn">OK</button>
          </form>
        </div>
      </div>

      <!-- Share Modal -->
      <div class="modal" id="share-modal">
        <div
          class="modal-content neon-modal-content"
          style="max-width: 350px; text-align: center"
        >
          <h2 class="modal-title" style="margin-bottom: 1.2rem">
            SHARE YOUR SCORE!
          </h2>
          <div
            id="share-options"
            style="
              display: flex;
              flex-direction: column;
              gap: 1.2rem;
              align-items: center;
              justify-content: center;
            "
          >
            <a
              id="share-whatsapp"
              class="neon-share-btn"
              href="#"
              target="_blank"
            >
              <img
                src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg"
                alt="WhatsApp"
                style="
                  width: 2.2rem;
                  height: 2.2rem;
                  margin-right: 0.7rem;
                  vertical-align: middle;
                  filter: drop-shadow(0 0 6px #25d366);
                "
              />
              WhatsApp
            </a>
            <a
              id="share-facebook"
              class="neon-share-btn"
              href="#"
              target="_blank"
            >
              <img
                src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/facebook.svg"
                alt="Facebook"
                style="
                  width: 2.2rem;
                  height: 2.2rem;
                  margin-right: 0.7rem;
                  vertical-align: middle;
                  filter: drop-shadow(0 0 6px #4267b2);
                "
              />
              Facebook
            </a>
            <a
              id="share-twitter"
              class="neon-share-btn"
              href="#"
              target="_blank"
            >
              <img
                src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/x.svg"
                alt="Twitter"
                style="
                  width: 2.2rem;
                  height: 2.2rem;
                  margin-right: 0.7rem;
                  vertical-align: middle;
                  filter: drop-shadow(0 0 6px #1da1f2);
                "
              />
              Twitter
            </a>
          </div>
          <button
            class="btn neon-leaderboard-btn"
            id="close-share-modal"
            style="margin-top: 2rem"
          >
            CLOSE
          </button>
        </div>
      </div>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        // Game elements
        const canvas = document.getElementById("game-board");
        const ctx = canvas.getContext("2d");
        const scoreDisplay = document.getElementById("score");
        const highScoreDisplay = document.getElementById("high-score");
        const levelDisplay = document.getElementById("level");
        const finalScoreDisplay = document.getElementById("final-score");
        const finalHighScoreDisplay =
          document.getElementById("final-high-score");
        const powerupIndicator = document.getElementById("powerup-indicator");

        // Modals
        const gameOverModal = document.getElementById("game-over-modal");
        const instructionsModal = document.getElementById("instructions-modal");
        const pauseModal = document.getElementById("pause-modal");

        // Buttons
        const startBtn = document.getElementById("start-btn");
        const restartBtn = document.getElementById("restart-btn");
        const resumeBtn = document.getElementById("resume-btn");

        // Touch controls
        const touchBtns = {
          up: document.getElementById("up-btn"),
          down: document.getElementById("down-btn"),
          left: document.getElementById("left-btn"),
          right: document.getElementById("right-btn"),
        };

        // Game settings
        let gridSize;
        let tileCount;
        const baseSpeed = 7;
        let speed = baseSpeed;
        let level = 1;

        // Game state
        let snake = [];
        let food = {};
        let powerup = null;
        let direction = { x: 1, y: 0 };
        let nextDirection = { x: 1, y: 0 };
        let score = 0;
        let highScore = localStorage.getItem("snakeHighScore") || 0;
        let gameRunning = false;
        let gamePaused = false;
        let gameLoop;
        let powerupTimeout;
        let speedBoostActive = false;
        let playerName = localStorage.getItem("snakePlayerName") || "";
        let currentTeammate = null;

        // Initialize displays
        highScoreDisplay.textContent = highScore;

        // Make canvas responsive
        function resizeCanvas() {
          const container = canvas.parentElement;
          // Guarantee a perfect square: use the smaller of width/height
          let size = Math.min(container.offsetWidth, container.offsetHeight);
          canvas.width = size;
          canvas.height = size;
          gridSize = Math.floor(size / 20);
          tileCount = Math.floor(size / gridSize);
        }

        window.addEventListener("resize", () => {
          resizeCanvas();
          if (gameRunning) draw();
        });
        resizeCanvas();

        // Touch controls
        Object.entries(touchBtns).forEach(([dir, btn]) => {
          btn.addEventListener("touchstart", (e) => {
            e.preventDefault();
            handleDirection(dir);
          });
        });

        // Keyboard controls
        document.addEventListener("keydown", (e) => {
          if (
            [
              "ArrowUp",
              "ArrowDown",
              "ArrowLeft",
              "ArrowRight",
              "Space",
              "KeyW",
              "KeyS",
              "KeyA",
              "KeyD",
            ].includes(e.code)
          ) {
            e.preventDefault();
          }

          if (e.code === "Space" && gameRunning) {
            togglePause();
            return;
          }

          // Only allow direction changes if the game is running
          if (!gameRunning) return;

          handleDirection(
            e.code.replace("Arrow", "").replace("Key", "").toLowerCase()
          );
        });

        function handleDirection(dir) {
          switch (dir) {
            case "up":
            case "w":
              if (direction.y === 0) nextDirection = { x: 0, y: -1 };
              break;
            case "down":
            case "s":
              if (direction.y === 0) nextDirection = { x: 0, y: 1 };
              break;
            case "left":
            case "a":
              if (direction.x === 0) nextDirection = { x: -1, y: 0 };
              break;
            case "right":
            case "d":
              if (direction.x === 0) nextDirection = { x: 1, y: 0 };
              break;
          }
        }

        function showModal(modal) {
          modal.classList.add("active");
        }

        function hideModal(modal) {
          modal.classList.remove("active");
        }

        function startGame() {
          // Reset game state
          snake = [
            { x: Math.floor(tileCount / 2), y: Math.floor(tileCount / 2) },
          ];
          direction = { x: 1, y: 0 };
          nextDirection = { x: 1, y: 0 };
          score = 0;
          level = 1;
          speed = baseSpeed;
          gameRunning = true;
          gamePaused = false;
          speedBoostActive = false;

          // Clear powerups
          if (powerupTimeout) clearTimeout(powerupTimeout);
          powerup = null;
          powerupIndicator.classList.remove("active");

          // Update displays
          scoreDisplay.textContent = score;
          highScoreDisplay.textContent = highScore;
          levelDisplay.textContent = level;

          // Hide modals
          hideModal(gameOverModal);
          hideModal(instructionsModal);
          hideModal(pauseModal);

          // Place initial food and schedule powerup
          placeFood();
          schedulePowerup();

          // Start game loop
          if (gameLoop) clearInterval(gameLoop);
          gameLoop = setInterval(gameUpdate, 1000 / speed);

          updatePauseResumeBtn();
        }

        function togglePause() {
          gamePaused = !gamePaused;

          if (gamePaused) {
            clearInterval(gameLoop);
            showModal(pauseModal);
          } else {
            hideModal(pauseModal);
            gameLoop = setInterval(gameUpdate, 1000 / speed);
          }
        }

        function gameUpdate() {
          direction = { ...nextDirection };

          if (direction.x === 0 && direction.y === 0) return;

          const head = {
            x: snake[0].x + direction.x,
            y: snake[0].y + direction.y,
          };

          // Check collisions
          if (
            head.x < 0 ||
            head.x >= tileCount ||
            head.y < 0 ||
            head.y >= tileCount ||
            snake.some(
              (segment) => segment.x === head.x && segment.y === head.y
            )
          ) {
            gameOver();
            return;
          }

          snake.unshift(head);

          // Check powerup collision
          if (powerup && head.x === powerup.x && head.y === powerup.y) {
            if (powerup.type === "speed") {
              activateSpeedBoost();
            } else {
              // Size powerup
              for (let i = 0; i < 3; i++) {
                snake.push({ ...snake[snake.length - 1] });
              }
            }
            powerup = null;
            powerupIndicator.classList.remove("active");
            schedulePowerup();
          }

          // Check food collision
          if (head.x === food.x && head.y === food.y) {
            score += 10;
            scoreDisplay.textContent = score;

            // Level up every 50 points
            const newLevel = Math.floor(score / 50) + 1;
            if (newLevel > level) {
              level = newLevel;
              levelDisplay.textContent = level;
              if (!speedBoostActive) {
                speed = baseSpeed + (level - 1) * 0.5;
                clearInterval(gameLoop);
                gameLoop = setInterval(gameUpdate, 1000 / speed);
              }
            }

            // Update high score
            if (score > highScore) {
              highScore = score;
              highScoreDisplay.textContent = highScore;
              localStorage.setItem("snakeHighScore", highScore);
            }

            placeFood();
          } else {
            snake.pop();
          }

          draw();
        }

        function activateSpeedBoost() {
          speedBoostActive = true;
          const originalSpeed = speed;
          speed *= 1.5;
          clearInterval(gameLoop);
          gameLoop = setInterval(gameUpdate, 1000 / speed);

          powerupIndicator.textContent = "SPEED BOOST!";
          powerupIndicator.style.color = "#ffff00";
          powerupIndicator.classList.add("active");

          setTimeout(() => {
            if (gameRunning && !gamePaused) {
              speedBoostActive = false;
              speed = originalSpeed;
              clearInterval(gameLoop);
              gameLoop = setInterval(gameUpdate, 1000 / speed);
              powerupIndicator.classList.remove("active");
            }
          }, 5000);
        }

        function schedulePowerup() {
          const delay = Math.random() * 10000 + 5000; // 5-15 seconds
          powerupTimeout = setTimeout(() => {
            if (gameRunning && !gamePaused) {
              placePowerup();
            }
          }, delay);
        }

        function placePowerup() {
          let newPowerupPos;
          do {
            newPowerupPos = {
              x: Math.floor(Math.random() * (tileCount - 2)) + 1, // keep inside visible area
              y: Math.floor(Math.random() * (tileCount - 2)) + 1,
              type: Math.random() < 0.5 ? "speed" : "size",
            };
          } while (
            snake.some(
              (segment) =>
                segment.x === newPowerupPos.x && segment.y === newPowerupPos.y
            ) ||
            (food.x === newPowerupPos.x && food.y === newPowerupPos.y)
          );

          powerup = newPowerupPos;

          setTimeout(() => {
            if (powerup) {
              powerup = null;
              schedulePowerup();
            }
          }, 5000);
        }

        function placeFood() {
          let newFoodPos;
          do {
            newFoodPos = {
              x: Math.floor(Math.random() * (tileCount - 2)) + 1, // keep inside visible area
              y: Math.floor(Math.random() * (tileCount - 2)) + 1,
            };
          } while (
            snake.some(
              (segment) =>
                segment.x === newFoodPos.x && segment.y === newFoodPos.y
            ) ||
            (powerup &&
              powerup.x === newFoodPos.x &&
              powerup.y === newFoodPos.y)
          );

          food = newFoodPos;
        }

        function draw() {
          // Clear canvas
          ctx.fillStyle = "#1a1a2e";
          ctx.fillRect(0, 0, canvas.width, canvas.height);

          // Draw grid
          ctx.strokeStyle = "#2a2a3a";
          ctx.lineWidth = 0.5;
          for (let i = 0; i <= tileCount; i++) {
            ctx.beginPath();
            ctx.moveTo(i * gridSize, 0);
            ctx.lineTo(i * gridSize, canvas.height);
            ctx.stroke();

            ctx.beginPath();
            ctx.moveTo(0, i * gridSize);
            ctx.lineTo(canvas.width, i * gridSize);
            ctx.stroke();
          }

          // Draw snake
          snake.forEach((segment, index) => {
            const alpha = index === 0 ? 1 : 0.7 - (index / snake.length) * 0.5;
            ctx.fillStyle = `rgba(0, 255, 157, ${alpha})`;
            ctx.shadowColor = "#00ff9d";
            ctx.shadowBlur = 10;
            ctx.fillRect(
              segment.x * gridSize + 1,
              segment.y * gridSize + 1,
              gridSize - 2,
              gridSize - 2
            );
          });

          // Draw food
          ctx.shadowColor = "#ff2d75";
          ctx.shadowBlur = 15;
          ctx.fillStyle = "#ff2d75";
          ctx.beginPath();
          ctx.arc(
            food.x * gridSize + gridSize / 2,
            food.y * gridSize + gridSize / 2,
            gridSize / 2 - 2,
            0,
            Math.PI * 2
          );
          ctx.fill();

          // Draw powerup
          if (powerup) {
            ctx.shadowColor = powerup.type === "speed" ? "#ffff00" : "#00ffff";
            ctx.shadowBlur = 15;
            ctx.fillStyle = powerup.type === "speed" ? "#ffff00" : "#00ffff";
            ctx.beginPath();
            ctx.arc(
              powerup.x * gridSize + gridSize / 2,
              powerup.y * gridSize + gridSize / 2,
              gridSize / 2 - 2,
              0,
              Math.PI * 2
            );
            ctx.fill();
          }

          ctx.shadowBlur = 0;
        }

        function gameOver() {
          gameRunning = false;
          clearInterval(gameLoop);

          finalScoreDisplay.textContent = score;
          finalHighScoreDisplay.textContent = highScore;

          showModal(gameOverModal);
        }

        // Event listeners for buttons
        startBtn.addEventListener("click", () => {
          hideModal(instructionsModal);
        });
        restartBtn.addEventListener("click", () => {
          startGame();
        });
        resumeBtn.addEventListener("click", () => {
          hideModal(pauseModal);
          togglePause();
        });

        // Initial draw
        draw();

        // --- INSTALL BUTTON (PWA) ---
        let deferredPrompt;
        const installBtn = document.getElementById("install-btn");
        window.addEventListener("beforeinstallprompt", (e) => {
          e.preventDefault();
          deferredPrompt = e;
          installBtn.style.display = "inline-block";
        });
        installBtn.addEventListener("click", async () => {
          if (deferredPrompt) {
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            if (outcome === "accepted") {
              installBtn.style.display = "none";
            }
            deferredPrompt = null;
          }
        });

        // --- SHARE BUTTON ---
        const shareBtn = document.getElementById("share-btn");
        const shareModal = document.getElementById("share-modal");
        const closeShareModal = document.getElementById("close-share-modal");
        const shareWhatsapp = document.getElementById("share-whatsapp");
        const shareFacebook = document.getElementById("share-facebook");
        const shareTwitter = document.getElementById("share-twitter");

        shareBtn.addEventListener("click", () => {
          const shareText = `I scored ${score} in Neon Snake! Can you beat me?`;
          const url = window.location.href;
          shareWhatsapp.href = `https://wa.me/?text=${encodeURIComponent(
            shareText + " " + url
          )}`;
          shareFacebook.href = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(
            url
          )}&quote=${encodeURIComponent(shareText)}`;
          shareTwitter.href = `https://twitter.com/intent/tweet?text=${encodeURIComponent(
            shareText
          )}&url=${encodeURIComponent(url)}`;
          shareModal.classList.add("active");
        });
        closeShareModal.addEventListener("click", () =>
          shareModal.classList.remove("active")
        );

        // --- LEADERBOARD ---
        const leaderboardBtn = document.getElementById("leaderboard-btn");
        const leaderboardModal = document.getElementById("leaderboard-modal");
        const leaderboardList = document.getElementById("leaderboard-list");
        const closeLeaderboardBtn = document.getElementById(
          "close-leaderboard-btn"
        );
        function getLeaderboard() {
          // Get top 10 scores from localStorage
          let scores = JSON.parse(
            localStorage.getItem("snakeLeaderboard") || "[]"
          );
          scores.sort((a, b) => b.score - a.score);
          return scores.slice(0, 10);
        }
        function updateLeaderboard(name, score) {
          let scores = JSON.parse(
            localStorage.getItem("snakeLeaderboard") || "[]"
          );
          // If name exists, keep only the highest score
          let found = false;
          scores = scores.map((entry) => {
            if (entry.name === name) {
              found = true;
              return {
                ...entry,
                score: Math.max(entry.score, score),
                date: new Date().toISOString(),
              };
            }
            return entry;
          });
          if (!found) {
            scores.push({ name, score, date: new Date().toISOString() });
          }
          localStorage.setItem("snakeLeaderboard", JSON.stringify(scores));
        }
        function showLeaderboard() {
          const scores = getLeaderboard();
          leaderboardList.innerHTML = scores.length
            ? `<ol>${scores
                .map(
                  (s) =>
                    `<li><strong>${s.name || "Player"}</strong>: ${
                      s.score
                    }</li>`
                )
                .join("")}</ol>`
            : "<p>No scores yet.</p>";
          leaderboardModal.classList.add("active");
        }
        leaderboardBtn.addEventListener("click", showLeaderboard);
        closeLeaderboardBtn.addEventListener("click", () =>
          leaderboardModal.classList.remove("active")
        );

        // --- GROUP/TEAMMATE MANAGEMENT ---
        const groupBtn = document.getElementById("group-btn");
        const groupModal = document.getElementById("group-modal");
        const groupList = document.getElementById("group-list");
        const closeGroupBtn = document.getElementById("close-group-btn");
        const addTeammateForm = document.getElementById("add-teammate-form");
        const teammateNameInput = document.getElementById("teammate-name");
        function getGroup() {
          return JSON.parse(localStorage.getItem("snakeGroup") || "[]");
        }
        function setGroup(group) {
          localStorage.setItem("snakeGroup", JSON.stringify(group));
        }
        function updateGroupList() {
          const group = getGroup();
          if (!group.length) {
            groupList.innerHTML = "<p>No teammates yet.</p>";
            return;
          }
          groupList.innerHTML = `<ul>${group
            .map(
              (t) =>
                `<li><strong>${
                  t.name
                }</strong>: High Score <span style='color:var(--secondary-neon)'>${
                  t.highScore || 0
                }</span> <button data-name="${
                  t.name
                }" class="btn" style="padding:0.2rem 0.7rem;font-size:0.8rem;margin-left:0.5rem;background:#222;">Remove</button></li>`
            )
            .join("")}</ul>`;
          // Remove teammate
          groupList.querySelectorAll("button[data-name]").forEach((btn) => {
            btn.onclick = () => {
              const name = btn.getAttribute("data-name");
              setGroup(group.filter((t) => t.name !== name));
              updateGroupList();
            };
          });
        }
        addTeammateForm.addEventListener("submit", (e) => {
          e.preventDefault();
          const name = teammateNameInput.value.trim();
          if (!name) return;
          let group = getGroup();
          if (!group.some((t) => t.name === name)) {
            group.push({ name, highScore: 0 });
            setGroup(group);
            updateGroupList();
          }
          teammateNameInput.value = "";
        });
        groupBtn.addEventListener("click", () => {
          updateGroupList();
          groupModal.classList.add("active");
        });
        closeGroupBtn.addEventListener("click", () =>
          groupModal.classList.remove("active")
        );

        // --- Name Entry Modal Logic ---
        const nameModal = document.getElementById("name-modal");
        const nameForm = document.getElementById("name-form");
        const playerNameInput = document.getElementById("player-name-input");

        function showNameModal(defaultName = "") {
          playerNameInput.value = defaultName;
          nameModal.classList.add("active");
          playerNameInput.focus();
        }
        function hideNameModal() {
          nameModal.classList.remove("active");
        }

        nameForm.addEventListener("submit", (e) => {
          e.preventDefault();
          playerName = playerNameInput.value.trim() || "Player";
          localStorage.setItem("snakePlayerName", playerName);
          // No restriction: allow any name
          const group = getGroup();
          currentTeammate =
            group.length && group.some((t) => t.name === playerName)
              ? playerName
              : null;
          hideNameModal();
          // Do not start the game automatically; wait for START button
        });

        // --- MAIN START & PAUSE/RESUME BUTTONS ---
        const mainStartBtn = document.getElementById("main-start-btn");
        const pauseResumeBtn = document.getElementById("pause-resume-btn");

        function updatePauseResumeBtn() {
          pauseResumeBtn.textContent = gamePaused ? "RESUME" : "PAUSE";
        }

        mainStartBtn.addEventListener("click", () => {
          if (!playerName) {
            showNameModal("");
          } else {
            startGame();
          }
        });

        pauseResumeBtn.addEventListener("click", () => {
          if (!gameRunning) return;
          togglePause();
          updatePauseResumeBtn();
        });

        // Update button label on pause/resume from other triggers
        const originalTogglePause = togglePause;
        togglePause = function () {
          originalTogglePause();
          updatePauseResumeBtn();
        };

        // Hide action buttons when instructions modal is active
        const gameActionButtons = document.getElementById(
          "game-action-buttons"
        );
        function updateActionButtonsVisibility() {
          if (instructionsModal.classList.contains("active")) {
            gameActionButtons.style.display = "none";
          } else {
            gameActionButtons.style.display = "flex";
          }
        }
        // Initial state
        updateActionButtonsVisibility();
        // When instructions modal is closed, show action buttons
        startBtn.addEventListener("click", () => {
          setTimeout(updateActionButtonsVisibility, 100); // after modal closes
        });
        // Also update on modal show/hide
        const originalShowModal = showModal;
        showModal = function (modal) {
          originalShowModal(modal);
          updateActionButtonsVisibility();
        };
        const originalHideModal = hideModal;
        hideModal = function (modal) {
          originalHideModal(modal);
          updateActionButtonsVisibility();
        };

        // Back button in Game Over modal
        const backBtn = document.getElementById("back-btn");
        backBtn.addEventListener("click", () => {
          hideModal(gameOverModal);
          showModal(instructionsModal);
        });
      });
    </script>
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker.register("service-worker.js");
        });
      }
    </script>
  </body>
</html>
